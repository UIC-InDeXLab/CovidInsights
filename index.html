<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>COVID-19</title>
    <link rel="icon" href="images/fa-head-side-mask.png">
    <link rel="stylesheet" href="styles/main.css">

    <script src="scripts/main.js"></script>

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <!--<script src="leaflet-ajax/dist/leaflet.ajax.min.js"></script>-->

    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css" integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" crossorigin="anonymous">
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js" integrity="sha384-wfSDF2E50Y2D1uUdj0O3uMBJnjuUD4Ih7YwaYd1iqfktj0Uod8GCExl3Og8ifwB6" crossorigin="anonymous"></script>

    <link rel="stylesheet" href="leaflet/leaflet.css" />
    <script src="leaflet/leaflet.js"></script>

    <script src="https://kit.fontawesome.com/bb32733e6d.js" crossorigin="anonymous"></script>
    <link rel="stylesheet" href="http://code.ionicframework.com/ionicons/1.5.2/css/ionicons.min.css">

    <link rel="stylesheet" href="awesomeMarkers/leaflet.awesome-markers.css">

    <script src="awesomeMarkers/leaflet.awesome-markers.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/leaflet-easybutton@2/src/easy-button.css">
    <script src="https://cdn.jsdelivr.net/npm/leaflet-easybutton@2/src/easy-button.js"></script>

    <script src="https://api.mapbox.com/mapbox-gl-js/v1.10.1/mapbox-gl.js"></script>
    <link href="https://api.mapbox.com/mapbox-gl-js/v1.10.1/mapbox-gl.css"


    <!--from Jakob's Github-->
    <script src="https://d3js.org/d3.v5.min.js"></script>
    <script src="js/c3.min.js"></script>
    <!--<script src="js/leaflet.js"></script>-->
    <script src="js/leaflet.markercluster.js"></script>
    <script src="js/leaflet-polygon.fillPattern.js"></script>
    <script src="js/topojson.v1.min.js"></script>
    <script src="js/chroma.min.js"></script>
    <!--<script src="js/jquery-3.3.1.min.js"></script>-->
    <script type="text/javascript" src="js/jquery.sparkline.min.js"></script>
    <script src="js/bootstrap.min.js"></script>
    <script src="js/bootstrap4-toggle.min.js"></script>
    <script src="js/bootstrap.bundle.min.js"></script>
    <script src="js/simplebar.min.js"></script>


</head>
<body>
    <div class="wrapper">
        <div id="mapid"></div>
        <!--<div><i class="fas fa-cogs"></i></div>-->
        <div id="setting">
            <div id="tempral">
                <b>Tempral Features:</b>
                <ul class="setting-list">
                    <li><input type="checkbox"> Total Number of Cases</li>
                    <li><input type="checkbox"> Total Number of Death</li>
                    <li><input type="checkbox"> Total Number of Recovery</li>
                </ul>
            </div>
            <div id="non-tempral">
                <b>Non-tempral Features:</b>
                <ul class="setting-list">
                    <li><input type="checkbox"> Population</li>
                    <li><input type="checkbox"> Geographical Area Size</li>
                    <li><input type="checkbox"> Population Density</li>
                    <li><input type="checkbox"> Number of Hospital Beds</li>
                    <li><input type="checkbox"> Average Income</li>
                </ul>
            </div>
        </div>
    </div>
</body>

<script>

    $(window).ready(function() {
        $('.loader').fadeOut("slow");
    });


    var d3locale = d3.formatDefaultLocale({
        "thousands": ",",
        "grouping": [3],
    });

    L.TopoJSON = L.GeoJSON.extend({
        addData: function(jsonData) {
            if (jsonData.type === 'Topology') {
                for (key in jsonData.objects) {
                    geojson = topojson.feature(jsonData, jsonData.objects[key]);
                    L.GeoJSON.prototype.addData.call(this, geojson);
                }
            } else {
                L.GeoJSON.prototype.addData.call(this, jsonData);
            }
        }
    });

    var worldBounds = L.latLngBounds(
        L.latLng(-60, -100), //Southwest
        L.latLng(80, 15) //Northeast
    );


    var mymap = L.map('mapid', {
        center: [44.63, 28.77],
        zoomControl: false,
        zoom: 2,
        maxZoom: 10,
        minZoom: 2,
        worldCopyJump: true
    });//.fitBounds(worldBounds);
    // .fitWorld()
    // new L.Control.Zoom({
    //     position: 'topright'
    // }).addTo(mymap);

    var gray = L.tileLayer('https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}@2x.png');
    // var dark = L.tileLayer('https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}@2x.png').addTo(mymap);
    var voyager =
        L.tileLayer('https://{s}.basemaps.cartocdn.com/rastertiles/voyager/{z}/{x}/{y}@2x.png').addTo(mymap);
    var satellite =
        L.tileLayer('https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}');

    var baseLayers = {
        'CARTO Light': gray,
        // 'Dark': dark,
        'CARTO Voyager': voyager,
        'ESRI Satellite': satellite
    }

    mymap.on('load', function() {
// Add a source for the state polygons.
        mymap.addSource('states', {
            'type': 'geojson',
            'data':
                'https://d2ad6b4ur7yvpq.cloudfront.net/naturalearth-3.3.0/ne_110m_admin_1_states_provinces_shp.geojson'
        });

// Add a layer showing the state polygons.
        mymap.addLayer({
            'id': 'states-layer',
            'type': 'fill',
            'source': 'states',
            'paint': {
                'fill-color': 'rgba(200, 100, 240, 0.4)',
                'fill-outline-color': 'rgba(200, 100, 240, 1)'
            }
        });
    });

    mymap.on('click', function(e) {

        var coord = e.latlng;
        var lat = coord.lat;
        var lng = coord.lng;
        console.log("You clicked the map at latitude: " + lat + " and longitude: " + lng);

        if (marker1 != undefined) {
            mymap.removeLayer(marker1);
        }

        var greenMarker = L.AwesomeMarkers.icon({
            icon: 'fa-cogs',
            markerColor: 'green'
        });

        marker1 = L.marker([lat, lng], {icon: greenMarker}).addTo(mymap);


        // new mapboxgl.Popup()
        //     .setLngLat(e.lngLat)
        //     .setHTML(e.features[0].properties.name)
        //     .addTo(mymap);
    });
    // L.tileLayer('https://api.mapbox.com/styles/v1/{id}/tiles/{z}/{x}/{y}?access_token={accessToken}', {
    //     attribution: 'Map data &copy; <a href="https://www.openstreetmap.org/">OpenStreetMap</a> contributors, <a href="https://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, Imagery Â© <a href="https://www.mapbox.com/">Mapbox</a>',
    //     maxZoom: 18,
    //     id: 'mapbox/streets-v11',
    //     tileSize: 512,
    //     zoomOffset: -1,
    //     accessToken: 'pk.eyJ1IjoiaGFzdGktc2hyZiIsImEiOiJja2FoY2JrZzkwaWxtMzJwano0cmE4YTliIn0.BeZpF5IqCiCb8iPU2cIkVQ'
    // }).addTo(mymap);

    var greenMarker = L.AwesomeMarkers.icon({
        icon: 'fa-cogs',
        markerColor: 'green'
    });

    var marker1 = L.marker([51.5, -0.09], {icon: greenMarker}).addTo(mymap);




    var redMarker = L.AwesomeMarkers.icon({
        icon: 'fa-cogs',
        markerColor: 'red'
    });


    $(document).ready(function() {
        $.ajax({
            type: "GET",
            url: "test.csv",
            dataType: "text",
            success: function(data) {processData(data);}
        });

    });

    var markers = [];

    function processData(allText) {
        var allTextLines = allText.split(/\r\n|\n/);
        var headers = allTextLines[0].split(',');
        var lines = [];

        for (var i=1; i<allTextLines.length; i++) {
            var data = allTextLines[i].split(',');
            if (data.length == headers.length) {


                var markerTemp = L.marker([data[0],data[1]], {icon: redMarker}).addTo(mymap);
                // markers.push(markerTemp);
                // console.log(markers);

            }
        }
        // alert(lines);
    }
    // console.log("last" + markers);
    //var testMarker = L.marker([51.941196,4.512291], {icon: redMarker}).addTo(mymap);

    // var marker2 = L.marker([41.9, -87.7], {icon: redMarker}).addTo(mymap);
    // markers[1].bindPopup("<div><b>Chicago</b>, 23 Aug</div><div class='details-button'><button id='loc-det'>Details</button></div>").openPopup();
    //
    // var marker3 = L.marker([59.5, 40], {icon: redMarker}).addTo(mymap);
    // markers[2].bindPopup("<div><b>Saint Petersburg</b>, 13 Feb</div><div class='details-button'><button id='loc-det'>Details</button></div>").openPopup();
    //
    // var marker4 = L.marker([33.5, -7], {icon: redMarker}).addTo(mymap);
    // markers[3].bindPopup("<div><b>Casablanca</b>, 10 Jan</div><div class='details-button'><button id='loc-det'>Details</button></div>").openPopup();
    //
    // var marker5 = L.marker([32.5, 62], {icon: redMarker}).addTo(mymap);
    // markers[4].bindPopup("<div><b>Herat</b>, 03 Dec</div><div class='details-button'><button id='loc-det'>Details</button></div>").openPopup();

    // markers[0].bindPopup("<div><b>Birmingham</b>, 12 Feb</div><div class='details-button'><button id='loc-det'>Details</button></div>").openPopup();

    // marker1.bindPopup("<div><b>London</b>, 23 Jun</div><div class='details-button'><button id='loc-det'>Details</button></div>").openPopup();

    L.easyButton('fa-cogs', function(btn, map){
        if($("#setting").css("display") == "none")
            $("#setting").css("display", "block");
        else
            $("#setting").css("display", "none");

    }).addTo(mymap);

    // var geojsonLayer = new L.GeoJSON.AJAX("cities.geojson");
    // geojsonLayer.addTo(mymap);
    //
    // var district_boundary = new L.geoJson();
    // district_boundary.addTo(mymap);
    //
    // $.ajax({
    //     dataType: "json",
    //     url: "cities.geojson",
    //     AccessControlAllowOrigin: "*",
    //     success: function(data) {
    //         $(data.features).each(function(key, data) {
    //             district_boundary.addData(data);
    //         });
    //     }
    // });

    var grayscale = L.tileLayer('http://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}@2x.png').addTo(mymap);
    var streets = L.tileLayer('http://{s}.basemaps.cartocdn.com/rastertiles/voyager_nolabels/{z}/{x}/{y}@2x.png');
    var satellite = L.tileLayer('https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}@2x');

    var baseLayers = {
        // 'Dark': dark,
        'Grayscale': grayscale,
        'Streets': streets,
        'Satellite': satellite
    }

    // mymap.on('click', function(e){
        // var coord = e.latlng;
        // var lat = coord.lat;
        // var lng = coord.lng;
        // console.log("You clicked the map at latitude: " + lat + " and longitude: " + lng);
        //
        // if (marker1 != undefined) {
        //     mymap.removeLayer(marker1);
        // };
        //
        // var greenMarker = L.AwesomeMarkers.icon({
        //     icon: 'fa-cogs',
        //     markerColor: 'green'
        // });
        //
        // marker1 = L.marker([lat, lng], {icon: greenMarker}).addTo(mymap);
        //
        // $.ajax({ url:'http://maps.googleapis.com/maps/api/geocode/json?latlng='+e.latlng.lat+','+e.latlng.lng+'&sensor=true',
        //     success: function(data){
        //         //var state = data.results[0].address_components[5].long_name;
        //         //var country = data.results[0].address_components[6].long_name;
        //         //$('.leaflet-popup-content').text(country);
        //         console.log(data.results[0]);
        //     }
        // });
        //popup.setLatLng(e.latlng).setContent('').openOn(mymap);

    // });


    var Group = L.layerGroup().addTo(mymap);


    Promise.all([
        d3.csv('assets/virus.csv'), //datasets[0]
        d3.json("assets/all-topo-15.json"), //datasets[1]
    ]).then(function(datasets) {

        function style(feature) {

            return {
                //fill: setFill(feature.properties.enname),
                fillColor: '#120456',
                fillOpacity: 0.4,
                weight: 0.5,
                opacity: 1,
                color: '#b4b4b4',
                dashArray: '2'
            };

        }

        var areas = new L.TopoJSON(datasets[1], {
            style: style,
            onEachFeature: onEachFeature
        }).addTo(mymap);

        // 3.2.3 reset the hightlighted feature when the mouse is out of its region.
        function resetHighlight(e) {
            areas.resetStyle(e.target);

        }

        // 3.3 add these event the layer obejct.
        function onEachFeature(feature, layer) {
            layer.on({
                mouseover: highlightFeature,
                click: openDetail,
                mouseout: resetHighlight
            });
        }

        function highlightFeature(e) {
            // e indicates the current event
            var layer = e.target; //the target capture the object which the event associates with
            layer.setStyle({
                weight: 2,
                opacity: 0.8,
                color: '#e3e3e3',
                fillColor: '#00ffd9',
                fillOpacity: 0.1
            });
            // bring the layer to the front.
            layer.bringToFront();
            // if (e.target.feature.properties.enname == "us" || e.target.feature.properties.enname == "canada") {
            //     layer.bringToBack();
            // }
        }

        function openDetail(e) {
            console.log("name: " + e.target.feature.properties.name);
        }


    });



</script>

</html>

